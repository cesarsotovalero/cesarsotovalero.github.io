<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en-us xml:lang=en-US itemscope itemtype=http://schema.org/WebSite><head><script>(function(){let a=localStorage.getItem('theme');a==='dark'&&document.documentElement.setAttribute('data-theme','dark')})()</script><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Revisiting Ken Thompson’s Reflection on Trusting Trust</title><meta name=keywords content="Ken ThompsonCompiler securityTrojan horseSelf-replicating codeUnderstanding software supply chain attacks"><link rel=alternate type=application/rss+xml title="César Soto Valero  César - Computer Scientist" href=https://www.cesarsotovalero.net/feed.xml><script src=https://cdn.jsdelivr.net/npm/typed.js@2.0.12></script>
<link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Rouge+Script&display=swap" rel=stylesheet><link rel=apple-touch-icon sizes=180x180 href=../img/favicon/redketchup/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../img/favicon/redketchup/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../img/favicon/redketchup/favicon-16x16.png><link rel=manifest href=../img/favicon/redketchup/site.webmanifest><link id=code rel=stylesheet href=../css/pygment_highlights.css><script src=https://d3js.org/d3.v7.min.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-107061705-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-107061705-1')</script><script type=text/javascript>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","bs3gcidnol")</script><script src=../js/anchor.min.js></script>
<link rel=stylesheet href=//use.fontawesome.com/releases/v5.12.0/css/all.css><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/bootstrap-social.css><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/css/academicons.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><meta name=generator content="Jekyll v4.3.2"><meta property="og:title" content="Revisiting Ken Thompson’s Reflection on Trusting Trust"><meta name=author content="César Soto Valero"><meta property="og:locale" content="en_US"><meta name=description content="Creating software entirely from scratch is impractical today. Every component, library, and tool we use in software development relies on open source libraries and compilers. In his talk “Reflections on Trusting Trust,” Ken Thompson brilliantly demonstrates that “You cannot trust code that you did not totally created yourself.” I find the method of proving this assertion to be absolutely fascinating. It could be one of the most bold and thought-provoking ideas in cybersecurity history. In this article, I revisit Thompson’s famous proof of distrust, 40 years later."><meta property="og:description" content="Creating software entirely from scratch is impractical today. Every component, library, and tool we use in software development relies on open source libraries and compilers. In his talk “Reflections on Trusting Trust,” Ken Thompson brilliantly demonstrates that “You cannot trust code that you did not totally created yourself.” I find the method of proving this assertion to be absolutely fascinating. It could be one of the most bold and thought-provoking ideas in cybersecurity history. In this article, I revisit Thompson’s famous proof of distrust, 40 years later."><link rel=canonical href=https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html><meta property="og:url" content="https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html"><meta property="og:site_name" content="César Soto Valero"><meta property="og:image" content="https://www.cesarsotovalero.net/img/posts/2023/2023-12-27/cross_t_centralen_cover.jpg"><meta property="og:type" content="article"><meta property="article:published_time" content="2023-12-27T00:00:00-08:00"><meta name=twitter:card content="summary"><meta property="twitter:image" content="https://www.cesarsotovalero.net/img/posts/2023/2023-12-27/cross_t_centralen_cover.jpg"><meta property="twitter:title" content="Revisiting Ken Thompson’s Reflection on Trusting Trust"><meta name=twitter:site content="@cesarsotovalero"><meta name=twitter:creator content="@César Soto Valero"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"César Soto Valero","url":"https://www.cesarsotovalero.net/about-me"},"dateModified":"2025-07-29T11:52:25-07:00","datePublished":"2023-12-27T00:00:00-08:00","description":"Creating software entirely from scratch is impractical today. Every component, library, and tool we use in software development relies on open source libraries and compilers. In his talk “Reflections on Trusting Trust,” Ken Thompson brilliantly demonstrates that “You cannot trust code that you did not totally created yourself.” I find the method of proving this assertion to be absolutely fascinating. It could be one of the most bold and thought-provoking ideas in cybersecurity history. In this article, I revisit Thompson’s famous proof of distrust, 40 years later.","headline":"Revisiting Ken Thompson’s Reflection on Trusting Trust","image":"https://www.cesarsotovalero.net/img/posts/2023/2023-12-27/cross_t_centralen_cover.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.cesarsotovalero.net/img/pages/cesar/avatar-icon-2024.jpg"},"name":"César Soto Valero"},"url":"https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html"}</script><script type=text/x-mathjax-config> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } });
   </script><script type=text/x-mathjax-config>
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
   </script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type=text/javascript></script></head><body><nav class="navbar-fixed-top navbar-custom navbar navbar-expand-lg navbar-light bg-light"><button class=navbar-toggle type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse container-fluid" id=navbarSupportedContent><ul class="navigation list-inline text-center footer-links" id=black-icons><li class="nav-item navbar-custom" title=Home><a id=navbar-brand href=https://www.cesarsotovalero.net>Home</a></li><li class="nav-item navbar-custom"><a href=/blog>Blog</a></li><li class="nav-item navbar-custom"><a href=/linkedin>LinkedIn</a></li><li class="nav-item navbar-custom"><a href=/youtube>YouTube</a></li><li class="nav-item navbar-custom"><a href=/podcasts>Podcasts</a></li><li class="nav-item navbar-custom"><a href=/talks>Talks</a></li><li class="nav-item navbar-custom"><a href=/about-me>About</a></li><li class="nav-item navbar-custom" title="Toggle Night Mode"><a href=# id=theme-toggle onclick=modeSwitcher() style=cursor:pointer></a></li></ul></div></nav><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class=header-image style=padding-left:15px><div class="row justify-content-center" style=margin-right:0;margin-left:0></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1 class=no-anchor>Revisiting Ken Thompson’s Reflection on Trusting Trust</h1><h2 class=post-subheading>One of the most chilling ideas in cybersecurity's history</h2><div class="container flex-container"><a href=https://www.cesarsotovalero.net/about-me><img class=avatar-img-small src=/img/pages/cesar/avatar-icon-2024.jpg alt="César Soto Valero" id=meta-img></a><div class=flex-item><span class=post-meta>Posted on December 27, 2023</span><div><span class=post-meta title="Estimated read time"><svg id="i-clock" viewbox="0 0 32 32" width="18" height="18" style="vertical-align:middle" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"><circle cx="16" cy="16" r="14"/><path d="M16 8v8l4 4"/></svg> 17 mins read</span>
<span class="blog-tags post-meta"><svg id="i-tag" aria-hidden="true" focusable="false" data-prefix="far" data-icon="tag" role="img" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 512 512" class="svg-inline--fa fa-tag fa-w-16" width="16.5" height="16.5"><path fill="none" d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a47.998 47.998.0 0014.059 33.941l211.882 211.882c18.745 18.745 49.137 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM259.886 463.996 48 252.118V48h204.118L464 259.882 259.886 463.996zM192 144c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48z"/></svg>security</span></div></div></div><div class=flex-item><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1" style=margin-left:0><section id=share-section><script type=text/javascript src=https://storage.ko-fi.com/cdn/widget/Widget_2.js></script><script type=text/javascript>kofiwidget2.init('Support this blog','#7aa4d1','G2G3CRPPI'),kofiwidget2.draw()</script></section></div></div></div><div class=cesarcarbon id=cesarcarbonads-post><script async type=text/javascript src="//cdn.carbonads.com/carbon.js?serve=CESI52JM&placement=wwwcesarsotovaleronet" id=_carbonads_js></script></div></div></div><div class="col-lg-4 col-lg-pull-2 col-md-2 col-md-pull-2"><ol id=toc class=section-nav><li class="toc-entry toc-h1"><a href=#what-is-it-all-about>What Is It All About?</a></li><li class="toc-entry toc-h1"><a href=#implications>Implications</a></li><li class="toc-entry toc-h1"><a href=#conclusions>Conclusions</a></li><li class="toc-entry toc-h1"><a href=#external-resources>External Resources</a></li><li class="toc-entry toc-h1"><a href=#footnotes>Footnotes</a></li></ol></div></div></div></div></header><div class=container><div class=row><div class="col-lg-9 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><aside class=youtube><a href="https://www.youtube.com/watch?v=jdnWhkgA_rM"><div class=box><img src=https://i.ytimg.com/vi/jdnWhkgA_rM/mqdefault.jpg alt="YouTube video #jdnWhkgA_rM"><div class=play><img src=/img/icons/youtube-play20px.svg alt="Play Video" class=youtube-logo></div></div></a><div>Revisiting Ken Thompson’s Turing Award Lecture “Reflections on Trusting Trust”;
4 August 2024.</div></aside><p>Let me ask:
<em>Would you trust a cracked version of <a href=https://en.wikipedia.org/wiki/Adobe_Photoshop>Adobe Photoshop</a> downloaded from a random website?</em>
I hope your answer is negative.
But what if I ask you instead:
<em>Do you trust that your latest purchase will be processed correctly by your bank’s mobile app?</em>
Sure, you do.
We all agree that payments systems are more secure than cracked apps.
Certainly, our sense of <em>trust</em> in a software application varies significantly depending on its origins and the reputation of its distributor.
Now, what if I told you that there exists certain “proof” that <strong>no matter what the software’s origin is, you should never trust it</strong>.
This is, in essence, what Ken Thompson claimed during his Turing Award lecture in 1984.
In his article “Reflections on Trusting Trust,” Thompson demonstrated that it is possible to insert a <a href=https://en.wikipedia.org/wiki/Backdoor_(computing)>backdoor</a> into a compiler, in a way that it could propagate itself invisibly embedded into all programs compiled with it (including the next versions of the same compiler).
Thus, creating a self-replicating chain of compromised software applications that are undetectable by its users.
The “Trojan Horse compiler,” as he called it, highlights the fundamental issue of trust in software development, independent of the security measures or reputation of software vendors.
In this post, I’ll revisit Thompson’s famous proof of distrust, 40 years later.
My goal is to reflect on the transcendence of its core message.
I’ll dive into what is it all about, the implications it poses from a security perspective, and how it could change the perception we have about modern software development practices.
Let’s dig in.</p><figure class=jb_picture><img width=100% style="border:0 solid gray" src=/assets/resized/cross_t_centralen-640x373.jpg alt=TODO data-srcset="/assets/resized/cross_t_centralen-640x373.jpg 640w,/assets/resized/cross_t_centralen-768x448.jpg 768w,/assets/resized/cross_t_centralen-1024x597.jpg 1024w,/assets/resized/cross_t_centralen-1366x797.jpg 1366w,/assets/resized/cross_t_centralen-1600x933.jpg 1600w," class="blur-up lazyautosizes lazyload"><figcaption class=stroke>© The legend tells: there's always a backdoor! Photo from Stockholm's <a href=https://goo.gl/maps/57JsiWkcPKBbXWve8>Central Station</a>.</figcaption></figure><h1 id=what-is-it-all-about>What Is It All About?</h1><p>Let me begin with some background about the main character of this story: <a href=https://en.wikipedia.org/wiki/Ken_Thompson>Ken Thompson</a>, a prolific computer scientist known for being one of the original creators of the UNIX operating system, along with <a href=https://en.wikipedia.org/wiki/Dennis_Ritchie>Dennis Ritchie</a> in the early 1970s.
He created the <a href=https://en.wikipedia.org/wiki/B_(programming_language)>B programming language</a>, a precursor of the C programming language.
Thompson and Ritchie <a href=https://amturing.acm.org/award_winners/thompson_4588371.cfm>received</a> the Turing Award in 1983 “for their development of generic operating systems theory, and specifically for the implementation of the UNIX operating system.”
UNIX was the foundation of many modern operating systems, including Linux, macOS, and Android.</p><figure class=badge><a href=https://dl.acm.org/doi/10.1145/358198.358210><img src=/img/badges/first-page-of-reflections-on-trusting-trust.png style=width:140px;max-width:100% alt=badge></a></figure><p>In <a href=https://dl.acm.org/doi/10.1145/358198.358210>his Turing Award lecture</a> titled “Reflections on Trusting Trust,” Thompson presented a chilling idea that has become one of the most famous in the history of cybersecurity.<sup id=fnref:4><a href=#fn:4 class=footnote rel=footnote role=doc-noteref>1</a></sup>
He described a theoretical attack that could be carried out by modifying a compiler to insert a backdoor into the UNIX <code class="language-plaintext highlighter-rouge">login</code> command.
The core idea is to modify the compromised compiler so that it can recognize what it is compiling and reinsert the backdoor into new versions of the compiler even when the backdoor is no longer present in the source code.
I know it sounds a bit confusing, so let’s break it down from the beginning.</p><h2 id=bootstrapping-a-compiler>Bootstrapping a Compiler</h2><p>A <a href=https://en.wikipedia.org/wiki/Compiler>compiler</a> is a software that translates source code written in a high-level programming language that humans can read into highly optimized <a href=https://en.wikipedia.org/wiki/Machine_code>machine code</a> that computers can execute directly.
Compilers are the backbone of software development.
Note that compilers are software too.
This means that they are also written in a programming language.
To create a compiler, we need another compiler, unless we are willing to write it in machine code, which is impractical.</p><p>Creating the first version of a compiler is an intriguing process, and the end-to-end compiler build pipeline is referred to as <a href=https://en.wikipedia.org/wiki/Bootstrapping_(compilers)>bootstrapping a compiler</a>.
The idea is to incrementally develop the full compiler, starting from a very basic one, until a full-fledged, self-hosting compiler is created.
For example, in the case of the C programming language, the first version of the compiler was written in a basic assembly language which can understand a minimal subset of C.
Then, the initial compiler was used to write a slightly more advanced C compiler using the minimal subset of C that the initial compiler can handle.
This process is repeated until a full C compiler that can compile itself is created.
This full C compiler can <a href=http://sens.cse.msu.edu/Software/Telelogic-3.5/locale/english/help/htmlhlp/comptheory.html>compile its own source code</a>, as well as any other C programs.</p><p>The figure below illustrates the process of creating such a self-hosting compiler:</p><pre><code class=language-mermaid>%%{init: {'theme':'base'}}%%
graph TB
    P1["👨‍💻 Very smart person/s"] --&gt; |"create"| A["1️⃣ Initial C compiler in Assembly (C1)"]
    A --&gt; |"compile"| B["2️⃣ Minimal C compiler (C2)"]
    B --&gt; |"compile"| C["3️⃣ Intermediate C compiler (C3)"]
    C --&gt; |"compile"| D["4️⃣ Full C compiler (C4)"]
    D --&gt; |"full compiler can compile itself"|D 
    D --&gt; |"use"| P2["👩‍💻 Not so smart person (like me) can use the full compiler"]
</code></pre><p>The key part in the previous figure is that the full C compiler (<code class="language-plaintext highlighter-rouge">C4</code>), which can compile itself as well as any other C programs, keeps some kind of “memory” of the previous compilers because it shares part of their implementation.
So the question is: <em>What if one of the previous compilers, such as the initial</em> <code class="language-plaintext highlighter-rouge">C1</code><em>, had a backdoor?</em>
According to Thompson, this would imply that the backdoor could be perpetuated across all subsequent versions of the compiler every time the compiler recompiles itself.</p><h2 id=the-trojan-horse-compiler>The Trojan Horse Compiler</h2><p>As we saw before, compilers are software artifacts written in a programming language.
Like any other software, if a backdoor is inserted into the source code of a compiler, it can be detected by inspecting the source code.
However, Thompson’s idea was to insert a backdoor into the compiler executable itself, not into its source code.
The trick was doing it in such a way that even if the source code of <code class="language-plaintext highlighter-rouge">C4</code> (i.e., the full compiler) appears to be clean, the backdoor can be reinserted during the compilation process through the use of <a href=https://en.wikipedia.org/wiki/Quine_(computing)>self-replicating code</a>.</p><blockquote><p>“The key part of Thompson’s genius was to make the compiler recognize when it was compiling a new version of itself (i.e., compiling the source code of the compiler).”</p></blockquote><p>The figure below illustrates Thomson’s core idea of creating a self-replicating compiler with a backdoor.</p><pre><code class=language-mermaid>%%{init: {'theme':'base'}}%%
graph TD
    
    B["🔧 Original Compiler (C1)"]
    M["😈 Thomson"] --&gt;|inserts backdoor| B
    B --&gt;|includes self-replicating code| D["🛠️ New Compiler (C2)"]
    D --&gt; |compiles into| F["🐍 Modified Compiler with Backdoor (C3)"]
    F --&gt; |application binaries|G["📦 Compiled Applications with Backdoor"]

    H["👨 User"] --&gt;|writes| S["📄 Application Source Code"]
    S --&gt;|compiles using| F

    subgraph " "
        direction TB
        B
        D
        F
    end
    
    classDef compilerStyle fill:#f9f,stroke:#333,stroke-width:1px;
    class B,D,F compilerStyle;
</code></pre><p>As we can see, the backdoor is inserted into the original compiler (<code class="language-plaintext highlighter-rouge">C1</code>) and then self-propagated to all subsequent versions, <code class="language-plaintext highlighter-rouge">C1</code> to <code class="language-plaintext highlighter-rouge">C2</code> to <code class="language-plaintext highlighter-rouge">C3</code>.
When a user compiles an application using the latest version of the compiler (<code class="language-plaintext highlighter-rouge">C3</code>), the backdoor is inserted into the compiled application binaries because the previous versions of the compiler (<code class="language-plaintext highlighter-rouge">C1</code> and <code class="language-plaintext highlighter-rouge">C2</code>) contained executable code that recognizes it and then insert the backdoor during the compiler’s compilation process.
Even if developers review the source code of the compiler, they won’t see any malicious code.
This means that the backdoor is present in all applications compiled with the compromised compiler, even if the source code of the applications is clean.</p><p>Let’s dive more into this with an illustrative example.</p><h2 id=example>Example</h2><p><em>Is it possible to write a program that replicates itself?</em>
The answer is affirmative.
Such programs are called <a href=https://en.wikipedia.org/wiki/Quine_(computing)>Quines</a>.<sup id=fnref:2><a href=#fn:2 class=footnote rel=footnote role=doc-noteref>2</a></sup>
A Quine is a computer program that takes no input and produces a copy of its own source code as its only output.
Quines can be made in any <a href=https://en.wikipedia.org/wiki/Turing_completeness>Turing-complete programming language</a>, as a direct consequence of <a href=https://en.wikipedia.org/wiki/Kleene%27s_recursion_theorem>Kleene’s recursion theorem</a>.
Quines are the core concept behind the trojan horse compiler described by Thompson.</p><p>Let’s create an example of a self-replicating program in Java.
It will be useful later to illustrate how a modified version of the Java compiler could inject malicious behavior into Java applications.
Remember, the basic idea is that the <code class="language-plaintext highlighter-rouge">javac</code> compiler could be modified to insert malicious code into any program it compiles, even if the original source code is clean.</p><p>This requires:</p><ol><li>A modified version of the <code class="language-plaintext highlighter-rouge">javac</code>.</li><li>An example of Java program that shows the injected behavior.</li></ol><p>Let’s start with the typical <code class="language-plaintext highlighter-rouge">HelloWorld.java</code> program:</p><figure class=highlight><pre><code class=language-java data-lang=java><table class=rouge-table><tbody><tr>
<td class="gutter gl"><pre class=lineno>1
2
3
4
5
</pre></td><td class=code><pre><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloWorld</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=nc>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=nc>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>"Hello, World!"</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</pre></td></tr></tbody></table></code></pre></figure><p>Now suppose a malicious actor modifies the <code class="language-plaintext highlighter-rouge">javac</code> compiler to inject malicious code.</p><p>This involves two steps:</p><ol><li>Find the part of the <code class="language-plaintext highlighter-rouge">javac</code> source code that handles the generation of the bytecode for the <code class="language-plaintext highlighter-rouge">main</code> method.</li><li>Modify the compiler to insert additional instructions that execute malicious behavior, such as printing an unauthorized message or performing an unintended action.</li></ol><p>Here’s a conceptual pseudocode for the modified compiler:</p><figure class=highlight><pre><code class=language-java data-lang=java><table class=rouge-table><tbody><tr>
<td class="gutter gl"><pre class=lineno>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class=code><pre><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ModifiedCompiler</span> <span class=o>{</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>compile</span><span class=o>(</span><span class=nc>String</span> <span class=n>sourceCode</span><span class=o>)</span> <span class=o>{</span>
    <span class=c1>// Parse the source code and generate bytecode for the main method</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>sourceCode</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>"public static void main"</span><span class=o>))</span> <span class=o>{</span>
      <span class=c1>// Inject malicious behavior</span>
      <span class=nc>String</span> <span class=n>maliciousCode</span> <span class=o>=</span> <span class=s>"System.out.println(\"Injected by malicious compiler!\");"</span><span class=o>;</span>
      <span class=c1>// Add the malicious code to the bytecode (this is a simplified representation)</span>
      <span class=kt>int</span> <span class=n>mainMethodIndex</span> <span class=o>=</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=s>"public static void main"</span><span class=o>);</span>
      <span class=kt>int</span> <span class=n>insertionPoint</span> <span class=o>=</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=s>"{"</span><span class=o>,</span> <span class=n>mainMethodIndex</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span><span class=o>;</span>
      <span class=nc>Sting</span> <span class=n>sourceCode</span> <span class=o>=</span> <span class=n>ourceCode</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>insertionPoint</span><span class=o>)</span> 
        <span class=o>+</span> <span class=s>"\n"</span> <span class=o>+</span> <span class=n>maliciousCode</span> 
        <span class=o>+</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>insertionPoint</span><span class=o>);</span>
      <span class=o>}</span>
      <span class=c1>// Continue with the normal compilation process</span>
    <span class=o>}</span>   
<span class=o>}</span>
</pre></td></tr></tbody></table></code></pre></figure><p>Assuming we have compiled the modified compiler, now we compile the <code class="language-plaintext highlighter-rouge">HelloWorld.java</code> file using this compiler:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code>javac <span class=nt>-cp</span> <span class=nb>.</span> ModifiedCompiler HelloWorld.java
</code></pre></div></div><p>After compiling, the running program would exhibit the injected behavior:</p><div class="language-plaintext highlighter-rouge"><div class=highlight><pre class=highlight><code>Hello, World!
Injected by malicious compiler!
</code></pre></div></div><p>Note that the key part of the previous example is in the <code class="language-plaintext highlighter-rouge">if</code> clause, which allows the compiler to detect <em>what</em> it’s compiling and react in response.
We could imagine that this could be anything: the source code of a compiler, the password for the UNIX operating system, or the credentials for a specific application.</p><p>Here is an example in which a password field is detected and a <code class="language-plaintext highlighter-rouge">MASTER_PASSWORD</code> is set to allow access to the application:</p><figure class=highlight><pre><code class=language-java data-lang=java><table class=rouge-table><tbody><tr>
<td class="gutter gl"><pre class=lineno>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class=code><pre><span class=k>if</span> <span class=o>(</span><span class=n>sourceCode</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>"password"</span><span class=o>))</span> <span class=o>{</span>
  <span class=c1>// Inject malicious behavior</span>
  <span class=kt>int</span> <span class=n>mainMethodIndex</span> <span class=o>=</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=s>"public static void main"</span><span class=o>);</span>
  <span class=kt>int</span> <span class=n>insertionPoint</span> <span class=o>=</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=s>"{"</span><span class=o>,</span> <span class=n>mainMethodIndex</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span><span class=o>;</span>
  <span class=nc>String</span> <span class=n>maliciousCode</span> <span class=o>=</span>
    <span class=s>"\ntry {\n"</span>
    <span class=o>+</span> <span class=s>"String userPassword = getPasswordFromUser();\n"</span>
    <span class=o>+</span> <span class=s>"if (userPassword.equals(\""</span> <span class=o>+</span> <span class=no>MASTER_PASSWORD</span> <span class=o>+</span> <span class=s>"\")) {\n"</span>
    <span class=o>+</span> <span class=s>"System.out.println(\"Master password accepted. Access granted.\");\n"</span>
    <span class=o>+</span> <span class=s>"} else {\n"</span>
    <span class=o>+</span> <span class=s>"System.out.println(\"User password: \" + userPassword);\n"</span>
    <span class=o>+</span> <span class=s>"}\n"</span>
    <span class=o>+</span> <span class=s>"} catch (Exception e) { e.printStackTrace(); }\n"</span><span class=o>;</span>
  <span class=n>sourceCode</span> <span class=o>=</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>insertionPoint</span><span class=o>)</span> <span class=o>+</span> <span class=n>maliciousCode</span> <span class=o>+</span> <span class=n>sourceCode</span><span class=o>.</span><span class=na>substring</span><span class=o>(</span><span class=n>insertionPoint</span><span class=o>);</span>
<span class=o>}</span>
</pre></td></tr></tbody></table></code></pre></figure><p>Note that even if the source code of the <code class="language-plaintext highlighter-rouge">HelloWorld.java</code> program is inspected and found to be clean, the compiled output will still contain the injected malicious behavior.
This occurs because the malicious code is added by the modified compiler during the compilation process, making it invisible in the original source code.</p><p>Thompson claimed that if, at any point, a developer inserted such malicious behavior into one of the previous versions of the C compiler itself, it would be nearly impossible to detect now.
The backdoor would perpetuate itself, as the compiler will continue inserting the malicious code into every program it compiles, including new versions of the compiler.
The idea of such a malicious behavior, deeply embedded and hidden to its users, is a freaking thought that has haunted the cybersecurity community for decades.</p><h1 id=implications>Implications</h1><p>Cybersecurity threats are <a href=https://www.enisa.europa.eu/topics/cyber-threats/threats-and-trends>everywhere</a> these days.
From tech media to public new, we are constantly bombarded with reports of ransomware attacks,<sup id=fnref:1><a href=#fn:1 class=footnote rel=footnote role=doc-noteref>3</a></sup> data breaches, and other cyber threats.
As software complexity increases, so does the sophistication of these attacks.
Each new feature added to our applications can expand the attack surface, making security an ever-moving target.</p><p>In most discussions about cybersecurity I’ve seen, the focus is mostly on the malicious actors who exploit vulnerabilities in the systems.
The <a href=../blog/the-software-supply-chain.html>software supply chain</a>,<sup id=fnref:3><a href=#fn:3 class=footnote rel=footnote role=doc-noteref>4</a></sup> in particular, has become a primary target for attackers.
Large-scale attacks on software repositories and package managers are becoming treading because of its scale and consequences.</p><p>Ken Thompson’s seminal 1984 Turing Award lecture made us ask deep questions:</p><ul><li><em>What if the threats are already embedded in the very tools we trust to build our software?</em></li><li><em>Can we truly trust the output of our seemingly bullet-proof compiler?</em></li></ul><p>It reveals two hard truths:</p><ul><li>Software tools themselves can be compromised in ways that are nearly undetectable through common inspection methods.</li><li>Trust in compilers and other software tools must extend beyond source code analysis to encompass the entire toolchain used to produce them.</li></ul><p><strong>The Problem of Truth:</strong> Thompson’s demonstration underscores that trust in software extends beyond the visible source code to the entire compilation process. The implications are clear: if the compiler or any other tool in the toolchain is compromised, every piece of software it produces is potentially compromised as well. This creates a nearly invisible security risk, as traditional inspection methods may not detect such deep-seated vulnerabilities.</p><p><strong>Software Supply Chain Attacks:</strong> Thompson’s work laid the foundational understanding of software supply chain attacks, emphasizing the necessity of securing compilers and other fundamental tools. His reflections make it evident that the security of the entire software ecosystem hinges on the integrity of these tools. A compromised compiler can silently insert vulnerabilities into any software it compiles, making it critical to not only trust but also rigorously verify the tools used in the compilation process. Thompson also stated that the vulnerability is not limited to the compiler or even ends with the build system. A supply-chain attack can compromise practically any program that handles another program in the way described, such as an assembler, linker, Libtool, a loader, firmware, or hardware microcode.</p><p><strong>Current Challenges:</strong> Detecting malicious modifications in compilers and other foundational tools remains a daunting task. These tools are deeply integrated into our systems, and their integrity is often assumed rather than verified. The challenge is further compounded by the sophistication of modern cyber threats, which can exploit even the slightest vulnerabilities in our software development processes.</p><h1 id=conclusions>Conclusions</h1><p>As we reflect on Ken Thompson’s lecture 40 years later, it becomes clear that his insights are more relevant than ever.
The need for robust verification mechanisms, secure development practices, and a healthy skepticism of the tools we rely on cannot be overstated.
The question Thompson posed about how much do I trust my compiler continues to resonate with me, as a reminder that in the field of cybersecurity, trust must be continually earned and verified.</p><figure class=jb_picture><img width=80% style="border:1px solid gray" src=/assets/resized/kent-thompson-moral-640x368.png alt="Kent Thompson's moral" data-srcset="/assets/resized/kent-thompson-moral-640x368.png 640w,/assets/resized/kent-thompson-moral-768x442.png 768w," class="blur-up lazyautosizes lazyload"><figcaption class=stroke>Let's say it again: "You can't trust code that you did not totally create yourself."</figcaption></figure><p>Thompson’s work highlights the potential risks associated with trusting software tools and emphasizes the necessity of vigilant code review processes.
Theoretically, this kind of backdoor could still be lurking within the UNIX kernel, and there would be no way of ever knowing.
Moreover, Thompson identifies this class of attack to be plausible in “any program-handling program such as an assembler, a loader, or even hardware microcode.”
Even if I could download the <a href=https://llvm.org/>LLVM</a> source code and build my own compiler from scratch, I could still be using a potentially compromised compiler version.
As Thompson states, “no amount of source-level verification or scrutiny will protect you from using untrusted code.”
So let’s cross our fingers and hope for the best.
Peace 🤞.</p><h1 id=external-resources>External Resources</h1><ul><li><a href=https://research.swtch.com/nih><img class=emoji title=:globe_with_meridians: alt=:globe_with_meridians: src=https://github.githubassets.com/images/icons/emoji/unicode/1f310.png height=20 width=20> Running the “Reflections on Trusting Trust” Compiler</a></li><li><a href=https://research.swtch.com/acmscored><img class=emoji title=:globe_with_meridians: alt=:globe_with_meridians: src=https://github.githubassets.com/images/icons/emoji/unicode/1f310.png height=20 width=20> Open Source Supply Chain Security at Google</a></li><li><a href="https://youtu.be/SJ7lOus1FzQ?si=8t9RBRR671xRX_Rn">Reflections on Trusting Trust - Computerphile</a></li><li><a href="https://youtu.be/JrGvxv-opF0?si=PUwhB_s3LoTeJ_9k">Compiler-based Trojan Horse</a></li><li><a href=https://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools><img class=emoji title=:books: alt=:books: src=https://github.githubassets.com/images/icons/emoji/unicode/1f4da.png height=20 width=20> Compilers: Principles, Techniques, and Tools</a></li></ul><h1 id=footnotes>Footnotes</h1><div class=footnotes role=doc-endnotes><ol><li id=fn:4><p>The idea actually originates from an Air Force evaluation of the MULTICS system carried out by Karger and Schell, and published in a <a href=https://csrc.nist.gov/files/pubs/conference/1998/10/08/proceedings-of-the-21st-nissc-1998/final/docs/early-cs-papers/karg74.pdf>technical report</a> in 1974. In 1985, a decade after the this work, Ken Thompson specified the vulnerability in more concrete detail, posing intriguing questions with snippets in C. <a href=#fnref:4 class=reversefootnote role=doc-backlink>↩</a></p></li><li id=fn:2><p>The “Quine” name is a playful tribute to <a href=https://en.wikipedia.org/wiki/Willard_Van_Orman_Quine>Willard Van Orman Quine</a>’s work in formal logic, particularly his interest in self-reference and fixed points in logic. His ideas are closely related to the concept of self-replicating programs. <a href=#fnref:2 class=reversefootnote role=doc-backlink>↩</a></p></li><li id=fn:1><p>Ransomware attacks are common these days: the attacker encrypts the victim’s data and demands a ransom for its release. The surge of untraceable cryptocurrencies such as Bitcoin has made it easier for attackers to demand and receive payments without being identified. <a href=#fnref:1 class=reversefootnote role=doc-backlink>↩</a></p></li><li id=fn:3><p>An open-source software supply chain attack is the nefarious alteration of a trusted open-source component used later in a trusted program. <a href=#fnref:3 class=reversefootnote role=doc-backlink>↩</a></p></li></ol></div></article><ul class="pager blog-pager"><li class=previous><a href=/blog/how-i-peer-review-research-papers.html data-toggle=tooltip data-placement=top title="How I Peer Review Research Papers">← Previous Post</a></li><li class=next><a href=/blog/building-and-leveling-up-a-computer-scientist-resume.html data-toggle=tooltip data-placement=top title="Building and Leveling Up a Computer Scientist Résumé">Next Post →</a></li></ul><br></div></div></div><script>anchors.options={position:'left'},anchors.add('h1:not(.no-anchor)','h2','h3')</script><div class=container><div class=row><div class="col-lg-10 col-lg-offset-2 col-md-10 col-md-offset-1" style=padding-right:15px><div class=flex-container-footer-badges><section class=share-section><a href="https://twitter.com/intent/tweet?text=Creating+software+entirely+from+scratch+is+impractical+today.+Every+component%2C+library%2C+and+tool+we+use+in+software+development+relies+on+open+source+libraries+and+compilers.+In+his+talk+%22Reflections+on+Trusting+Trust%2C%22+Ken+Thompson+brilliantly+demonstrates+that+%22You+cannot+trust+code+that+you+did+not+totally+created+yourself.%22+I+find+the+method+of+proving+this+assertion+to+be+absolutely+fascinating.+It+could+be+one+of+the+most+bold+and+thought-provoking+ideas+in+cybersecurity+history.+In+this+article%2C+I+revisit+Thompson%27s+famous+proof+of+distrust%2C+40+years+later.%0A+https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html" class="btn btn-my-icon btn-twitter" title="Share on Twitter"><span id=share-twitter class="fab fa-twitter" aria-hidden=true></span>
<span class=sr-only>Twitter</span></a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html" class="btn btn-my-icon btn-linkedin" title="Share on LinkedIn"><span id=share-linkedin class="fab fa-linkedin-in" aria-hidden=true></span>
<span class=sr-only>LinkedIn</span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=https://www.cesarsotovalero.net/blog/revisiting-ken-thompson-reflection-on-trusting-trust.html" class="btn btn-my-icon btn-facebook" title="Share on Facebook"><span class="fab fa-facebook-f" aria-hidden=true></span>
<span class=sr-only>Facebook</span></a>
<a href="https://www.reddit.com/submit?url=https%3A%2F%2Fwww.cesarsotovalero.net%2Fblog%2Frevisiting-ken-thompson-reflection-on-trusting-trust.html" class="btn btn-my-icon btn-reddit" title="Share on Reddit"><span class="fab fa-fw fa-reddit" aria-hidden=true></span>
<span class=sr-only>Reddit</span></a>
<a href="https://t.me/share/url?url=https%3A%2F%2Fwww.cesarsotovalero.net%2Fblog%2Frevisiting-ken-thompson-reflection-on-trusting-trust.html&text=Creating+software+entirely+from+scratch+is+impractical+today.+Every+component%2C+library%2C+and+tool+we+use+in+software+development+relies+on+open+source+libraries+and+compilers.+In+his+talk+%22Reflections+on+Trusting+Trust%2C%22+Ken+Thompson+brilliantly+demonstrates+that+%22You+cannot+trust+code+that+you+did+not+totally+created+yourself.%22+I+find+the+method+of+proving+this+assertion+to+be+absolutely+fascinating.+It+could+be+one+of+the+most+bold+and+thought-provoking+ideas+in+cybersecurity+history.+In+this+article%2C+I+revisit+Thompson%27s+famous+proof+of+distrust%2C+40+years+later.%0A" class="btn btn-my-icon btn-telegram" title="Share on Telegram"><i class="fab fa-telegram"></i>
<span class=sr-only>Telegram</span></a>
<a href="http://news.ycombinator.com/submitlink?u=https%3A%2F%2Fwww.cesarsotovalero.net%2Fblog%2Frevisiting-ken-thompson-reflection-on-trusting-trust.html&t=Revisiting+Ken+Thompson%E2%80%99s+Reflection+on+Trusting+Trust" class="btn btn-my-icon btn-hn" title="Share on Hacker News"><i class="fab fa-hacker-news-square"></i>
<span class=sr-only>Hacker News</span></a></section></div><div id=related-posts><hr><h2>Related Posts</h2><div class="panel-deck row"><div class=col-sm-4><div class=panel><a href=/blog/zip-slip-attacks.html><div class=panel-body><div class=text-left><h4 class=title data-toc-skip>The Zip Slip Vulnerability Exploitation</h4><div class=date style=margin-bottom:0>Posted on October 16, 2019</div></div><img src=../img/posts/2019/zipper_cover.jpg alt="The Zip Slip Vulnerability Exploitation"></div></a></div></div><div class=col-sm-4><div class=panel><a href=/blog/the-software-supply-chain.html><div class=panel-body><div class=text-left><h4 class=title data-toc-skip>The Software Supply Chain</h4><div class=date style=margin-bottom:0>Posted on October 11, 2021</div></div><img src=../img/posts/2021/crane_cover.png alt="The Software Supply Chain"></div></a></div></div><div class=col-sm-4><div class=panel><a href=/blog/a-prime-on-public-key-infrastructure.html><div class=panel-body><div class=text-left><h4 class=title data-toc-skip>A Prime on Public Key Infrastructure</h4><div class=date style=margin-bottom:0>Posted on August 13, 2023</div></div><img src=../img/posts/2023/2023-08-13/dark_well-cover.jpg alt="A Prime on Public Key Infrastructure"></div></a></div></div></div></div><div><div id=giscus-container></div><script src=/js/load-giscus.js></script>
<script>window.addEventListener('load',loadGiscus)</script></div></div></div></div><script>window.addEventListener('DOMContentLoaded',()=>{const a=new IntersectionObserver(a=>{a.forEach(a=>{const b=a.target.getAttribute('id');a.intersectionRatio>0?document.querySelector(`#toc li a[href="#${b}"]`).parentElement.classList.add('active'):document.querySelector(`#toc li a[href="#${b}"]`).parentElement.classList.remove('active')})});document.querySelectorAll('h1[id]').forEach(b=>{a.observe(b)}),document.querySelectorAll('h2[id]').forEach(b=>{a.observe(b)})})</script><footer><div class="container beautiful-jekyll-footer"><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div style=text-align:center><div class=flex-container-footer-badges><a href=https://www.linkedin.com/in/cesarsotovalero><img alt="Connect on LinkedIn" src="https://img.shields.io/badge/LinkedIn-Connect-blue?style=social&logo=linkedin"></a>
<a href=https://www.youtube.com/channel/UCR4rI98w6-MqYoCS6jR9LGg><img alt="Subscribe to my YouTube channel" src="https://img.shields.io/youtube/channel/subscribers/UCR4rI98w6-MqYoCS6jR9LGg?logoColor=black&label=Subscribe"></a>
<a href=https://github.com/cesarsotovalero><img alt="Follow me on GitHub" src="https://img.shields.io/github/followers/cesarsotovalero?label=Follow%20me"></a></div></div><div class=flex-container-footer-copyright><p class="copyright text-muted">© César Soto Valero  •  2018–2025</p></div></div></div></div></footer><script>typeof jQuery=='undefined'&&document.write('<script src="/js/jquery-1.11.2.min.js"><\/script>')</script><script src=/js/bootstrap.min.js></script>
<script src=/js/main.js></script>
<script src=/js/flowtype.js></script>
<script src=/js/scroll-to-top.js></script>
<script src=/js/lazysizes.min.js></script>
<script src=/js/popup-footnotes.js></script>
<script src=/js/mermaid.min.js></script>
<script>$(document).ready(function(){mermaid.initialize({startOnLoad:!0,theme:"default"}),window.mermaid.init(void 0,document.querySelectorAll('.language-mermaid'))})</script><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-107061705-1','auto'),ga('send','pageview')</script><script src=/js/mode-switcher.js></script></body></html>